### author webber (web-ber12@yandex.ru)


### набор eFilter - автоматическое построение фильтров товаров в MODx Evo (версия 0.1)

### содержит:
- модуль eLists - для удобного формирования списков значений ТВ (чтобы не захламлять дерево и визуально понятно их редактировать)
- плагин tovarParams - для показа в админке при редактировании товара только тех параметров, которые заданы для данной категории товаров
- набор сниппетов для формирования формы и проведения фильтрации

### обязательные дополнительные компоненты (без их установки решение не работает):
- сниппет DocLister
- компонент multiTV
- сниппет DocInfo

### установка
1. установить необходимые компоненты (модуль, плагин, сниппеты). Также скопировать конфигурацию для multiTV (\assets\tvs\multitv\configs\tovarparams.config.inc)
2. создать специальный TV с именем tovarparams, описание - Параметры товара, тип ввода - CustomInput, возможные значения @INCLUDE assets/tvs/multitv/multitv.customtv.php и присвоить этот tv всем шаблонам-категориям товара
3. создать шаблон для вывода товара
4. Включить 'общие' параметры в настройках модуля и добавить зависимости
  Plugins
tovarParams

  Snippets
eFilter
eFilterResult
multiParams
tovarParams
5. Отредактировать параметры настройки модуля  - &param_tv_id=ID TV параметров товара;string; &product_template_id=ID шаблона товара;string; &param_cat_id=ID категории параметров;string; &exclude_tvs_from_list=Не включать ТВ в параметры при выводе;string; &tovarChunkName=Имя чанка вывода товара;string;
где
&param_tv_id - id tv в котором размещается вызов multiTV для настройки параметров товара (созданный в пункте 2)
&product_template_id=ID шаблона товара  - он общий для всех видов товаров
&param_cat_id=ID категории параметров (фильтруемые параметры TV и просто параметры для товаров в TV должны быть помещены для идентификации в отдельную категорию/категории - например "Параметры товара" - id этой категории и необходимо сюда внести
              это очень важно
&exclude_tvs_from_list=Не включать ТВ в параметры при выводе - т.к. изначально в списке параметров будут выведены все параметры для данного типа товара из категории "Параметры товара", то можно его проредить, убрав ненужные ТВ (например цена, наличие и другие общие параметры для всех товаров которые можно вывести отдельно) 
&tovarChunkName=Имя чанка вывода товара;string - имя чанка вывода товара в список (используется вместо задания &tpl) 

6. Для каждой категории товаров можно настроить в TV "Параметры товара" из multiTV свой набор для параметров товара
7. На страницах категорий товаров, где необходим фильтр разместить вызов сниппета [!eFilter!], затем - в нужном месте шаблона плейсхолдер для вывода формы фильтра [+eFilter_form+] и сниппет для вывода результата 
например

		[!eFilterResult? &addWhereList=`c.template=9` &parents=`[*id*]` &depth=`3` &paginate=`pages` &display=`15` &tvList=`image,price`!]
		
		[+pages+]
		
		где 9 - это id шаблона товара (необязательно, используется для ускорения выборки)
		в данном сниппете используется DocLister, собственно, параметры вызова аналогичны.
		В чанке вывода товара в список &tpl плейсхолдер [+params+] будет заменен на список установленных для данной категории товаров параметров товара
		В параметре &tvList=`image,price` включаем нужные параметры из других категорий, а также общих tv-параметров для всех видов товаров
8. У нужном месте шаблона вывода товара (он у нас общий для всех видов товаров) помещаем вызов сниппета [[tovarParams]] для вывода нужного списка нужных ТВ из категории "Параметры товара" (id этой категории задан в модуле и он важен для всей работы).
		

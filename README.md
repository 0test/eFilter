### author webber (web-ber12@yandex.ru)

### набор eFilter - автоматическое построение фильтров товаров в MODx Evo (версия 0.1)

### DONATE
---------
если считаете данный продукт полезным и хотите отблагодарить автора материально,
либо просто пожертвовать немного средств на развитие проекта - 
можете сделать это на любой удобный Вам электронный кошелек в системе <strong>Webmoney</strong><br>
<strong>WMR:</strong> R133161482227<br>
<strong>WMZ:</strong> Z202420836069<br>
с необязательной пометкой от кого и за что именно :)


### содержит:
- модуль eLists - для удобного формирования списков значений ТВ (чтобы не захламлять дерево и визуально понятно их редактировать)
- плагин tovarParams - для показа в админке при редактировании товара только тех параметров, которые заданы для данной категории товаров
- набор сниппетов для формирования формы и проведения фильтрации

### обязательные дополнительные компоненты (без их установки решение не работает):
- сниппет DocLister
- компонент multiTV
- сниппет DocInfo

### автоматическая установка
1. Найдите в Extras сниппет eFilter (версия 0.1) и нажмите установить.<br>
При этом создадутся все необходимые элементы и связи между ними:<br>
- модуль eLists<br>
- сниппеты (eFilter, eFilterResult, multiParams, tovarParams, getSortBlock)<br>
- плагин eFilterHelper<br>
- TV tovarparams<br>
Переходим к пункту "Настройка"

### ручная установка
1. установить необходимые компоненты (модуль, плагин, сниппеты). Также скопировать конфигурацию для multiTV (\assets\tvs\multitv\configs\tovarparams.config.inc)
2. создать специальный TV с именем tovarparams, описание - Параметры товара, тип ввода - CustomInput, возможные значения @INCLUDE assets/tvs/multitv/multitv.customtv.php и присвоить этот tv всем шаблонам-категориям товара
3. создать шаблон для вывода товара
4. Включить 'общие' параметры в настройках модуля и добавить зависимости
==Plugins==
tovarParams
==Snippets==
eFilter
eFilterResult
multiParams
tovarParams

### настройка

5. Отредактировать параметры настройки модуля<br>
**ID TV параметров товара tovarparams** - вписываем сюда id нашего созданного при установке tv tovarparams<br>
**ID шаблонов товара** - перечисляем через запятую id шаблонов "Товар"<br>
**ID категории параметров** - ID категории, в которой будут храниться все tv, в которых задаются параметры товара (размер, цвет, материал и т.п.)<br>
**Не включать ТВ в параметры при выводе** -  - т.к. изначально в списке параметров будут выведены все параметры для данного типа товара из категории "Параметры товара", то можно его проредить, убрав ненужные ТВ (например цена, наличие и другие общие параметры для всех товаров которые можно вывести отдельно) <br>
**Имя чанка вывода товара** - имя чанка вывода товара в список (используется вместо задания &tpl) <br>
**Папка паттернов** - папка для хранения паттернов (фильтрация по типу "паттерн")<br>
**ID TV, используемого для связки товар-категории через tagSaver** - если вы используете для создания тегов плагин tagSaver и хотите, чтобы товары участвовали в фильтрации по притегованной категории - введите сюда id tv, которые обрабатываются плагином tagSaver<br>

6. Для каждой категории товаров можно настроить в TV "Параметры товара" из multiTV свой набор для параметров товара

7. На страницах категорий товаров, где необходим фильтр разместить вызов сниппета [!eFilter!] (либо [!eFilter? &tvConfig=`[*tovarparams*]`!], где tovarparams - это имя TV, в котором хранится json-конфиг из multiTV - это ускоряет обработку), затем - в нужном месте шаблона плейсхолдер для вывода формы фильтра [+eFilter_form+] и сниппет для вывода результата 
например

    <b>Дополнительные параметры вызова сниппета eFilter</b>
	&hidZero=`1` - если не указан, то при отсутствии вариантов показывает в количестве найденных 0, если указан - ничего не показывает
    &removeDisabled=`1` - удалять варианты с нулевым результатом из списка возможных (по умолчанию - 0 - варианты в списке остаются с атрибутом disabled)
    &ajax=`1` - режим ajax - подгрузка формы и результатов поиска после сабмита формы поиска без перезагрузки страницы (по умолчанию - отключен)
	в режиме ajax три callback-функции javascript
		- beforeFilterSend(_form) - исполняется до отправки состояния формы на сервер
		- afterFilterSend(msg) - исполняется после получения ответа от сервера msg
		- afterFilterComplete(_form) - исполняется после обновления фильтра и результатов поиска из ответа на сервере

        [!eFilterResult? &parents=`[*id*]` &depth=`3` &paginate=`pages` &display=`15` &tvList=`image,price`!]

        [+pages+]

        в данном сниппете используется DocLister, собственно, параметры вызова аналогичны.
        В чанке вывода товара в список &tpl плейсхолдер [+params+] будет заменен на список установленных для данной категории товаров параметров товара
        В параметре &tvList=`image,price` включаем нужные параметры из других категорий, а также общих tv-параметров для всех видов товаров
8. У нужном месте шаблона вывода товара (он у нас общий для всех видов товаров) помещаем вызов сниппета [[tovarParams]] для вывода нужного списка нужных ТВ из категории "Параметры товара" (id этой категории задан в модуле и он важен для всей работы).
9. Для удаления недоступных для выбора вариантов надо вызывать фильтр с параметром &removeDisabled=`1` - [!eFilter? &removeDisabled=`1`!]


### Сотрудничество:
---------
По вопросам сотрудничества обращайтесь на электронный ящик web-ber12@yandex.ru
